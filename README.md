# streaming-overlay-system
直播主 OBS 資訊顯示系統
# 直播主 OBS 資訊顯示系統 - 完整需求規格書

## 🎯 專案概述

開發一個提供直播主可搭配 OBS 呈現的資訊顯示系統，整合多平台聊天室訊息、斗內進度追蹤及各種客製化顯示功能。

## 📊 系統規模與架構

- **系統規模**: 小型 (1-100人使用)
- **主要使用者**: 直播主
- **雲端平台**: 混合雲
- **預算考量**: 免費額度內
- **預期併發數**: 少於 10 人

## 🎪 功能需求

### 前台功能

#### 核心設計原則
- 所有功能依據登入者有一個不變動的網址
- 可以不登入就觀看
- 每個功能的顯示內容配合後台設定顯示
- 背景透明顯示，適合 OBS 整合
- URL 格式：`/display/{type}/{userId}/{styleId}`

#### 具體功能模組

##### 1. 直播室整合顯示
- 依據後台設定不同的風格直播室整合
- 整合 YouTube 與 Twitch 直播室訊息
- 整合綠界科技付款通知訊息
- 顯示當時訂閱頻道觀眾名稱
- 依據時間整合背景透明顯示
- 聊天室內容不紀錄，當下顯示即可
- **即時性要求**: < 500ms 延遲

##### 2. 斗內目標進度軸
- 依據後台設定顯示斗內目標進度軸
- 支援即時更新動畫效果
- 可手動修正進度
- 可客製化樣式設定

##### 3. 簡易 Loading 頁面
- 提供可參數化的 Loading 動畫
- 支援多種自訂模式

##### 4. 時間顯示功能
- 依據後台設定不同的時間顯示方式
- 支援多種時間顯示模板：
  - 手機首頁顯示的時間樣式
  - 數字顯示時鐘
  - 最簡單文字時間顯示

### 後台功能

#### 1. 直播室整合管理
- **1-1. 多帳號連結**：連結多個 YT 帳號與 Twitch 帳號登入，以利有權限抓取直播聊天室訊息
- **1-2. 綠界整合**：整合綠界科技付款完成通知回傳網址，產生專屬 Webhook URL
- **1-3. 樣式設定**：設定多個不同風格直播室整合顯示頁面
  - 模式名稱（自訂）
  - 字體設定
  - 文字大小
  - 文字顏色
  - 呈現樣式（橫的一行顯示、對話框、彈幕、筆記本等）
  - 呈現樣式顏色
- **1-4. 直播監控介面**：後台給直播顯示觀看監控聊天室的介面
  - 可設定文字顯示大小
  - [開始直播] 按鈕控制聊天室內容擷取
  - 顯示聊天室關鍵字分析
  - 新觀眾標記（初見標記 "New!"）
  - 判斷初見還是再訪
  - 整理顯示這次直播中出現的觀眾列表
  - 不同頁籤方便切換
  - [直播結束] 後顯示聊天室關鍵字變化時間 LOG 文字列表
  - 將來訪觀眾紀錄做後續判斷是否初見的資料

#### 2. 斗內進度軸管理
- 配合前端斗內目標進度軸設定
- 依據聊天室監聽的不同平台聊天內容有的金額收入能動態調整
- 支援手動修正斗內目標進度軸
- 樣式設定：
  - 模式名稱（自訂）
  - 字體設定
  - 文字大小
  - 文字顏色
  - 進度條顏色

#### 3. Loading 頁面管理
- 提供網頁內容設定
- 將可以參數化的部分都可讓人設定
- 可設定好幾個自訂模式

#### 4. 時間顯示管理
- 將可以參數化的部分都可讓人設定
- 可設定好幾個自訂模式
- 樣式設定：
  - 模式名稱（自訂）
  - 字體設定
  - 文字大小
  - 文字顏色

## 👥 使用者管理

- **登入方式**: Google 登入
- **權限模式**: 單一權限
- **userId 設計**: 隨機生成的主鍵 (PK)，與登入者任何訊息都無關，確保隱私保護

## 🛠️ 技術架構

### 開發技術
- **前端**: React + TypeScript
- **後端**: Node.js + Express + TypeScript  
- **即時通訊**: Socket.IO + Server-Sent Events
- **資料庫**: PostgreSQL (生產) + SQLite (開發)
- **快取**: Redis
- **認證**: Firebase Auth (Google 登入)

### 選擇理由
- **React**: 組件化開發適合多個可配置的顯示模式，豐富的生態系統支援 OBS 整合
- **Node.js**: JavaScript 全棧統一，優秀的 WebSocket 支援，豐富的第三方 API 整合庫
- **TypeScript**: 提供更好的類型安全和開發體驗
- **Socket.IO**: 處理前後端即時數據同步，支援多重連接保障

### 部署架構
- **容器化**: Docker 部署
- **前端**: Vercel (免費額度，自動 HTTPS)
- **後端**: Railway 或 Render (免費額度，支援 WebSocket)
- **資料庫**: Supabase (提供免費 PostgreSQL)

## 🔐 安全性與合規

### 資料管理策略
- **觀眾來訪記錄**: 一直保存，除非帳號超過半年未登入，那此帳號全部移除
- **聊天關鍵字LOG**: 不保存資料，結束當下直接提供下載檔案
- **系統日誌**: 標準級記錄
- **敏感資料**: API Keys、密碼等進行加密保護

### 安全防護
- **基本安全**: 密碼加密、HTTPS、輸入驗證
- **API 保護**: 基礎驗證 + 基礎 Rate Limiting
- **個資合規**: 符合台灣個資法規範
- **金流合規**: 遵循綠界科技規範

### API 限制處理
- 當達到 API 呼叫限制時通知管理員
- 後續功能先暫停到限制開啟
- 先不做任何回應，維持靜默模式

## 🎨 使用者介面設計

### 視覺設計
- **風格**: 簡約現代 (Apple 風格)
- **色彩**: #FFA24B、暖色系
- **主題**: 簡約現代風格 + 暗色主題切換
- **響應式設計**: 支援桌機、筆電、手機、平板

### 多語言支援
- **支援語言**: 繁體中文 + 英文
- **切換方式**: 使用者可自由切換語言

## ⚡ 效能與即時性

### 即時性需求
- **聊天室訊息顯示**: < 500ms 延遲
- **斗內進度軸**: 即時更新，支援動畫過渡
- **WebSocket**: 雙重連接保障（主連接 + 備用連接）
- **心跳檢測**: 每 3 秒檢測連線狀態
- **斷線重連**: 自動重連機制

### 性能優化
- **CDN 加速**: 靜態資源全球分發
- **Redis 快取**: 熱門數據毫秒級讀取
- **WebSocket 集群**: 支援水平擴展
- **資料庫連接池**: 避免連接延遲

## 🔌 第三方整合

### 綠界科技整合
- **Webhook 通知**: 付款完成通知回傳網址
- **即時顯示**: 斗內訊息即時顯示在直播畫面
- **安全驗證**: 使用 HashKey 解密驗證付款通知真實性

### 直播平台整合
- **API 管理策略**: 系統管理者申請統一 API，使用者透過 OAuth 授權
- **YouTube Integration**: YouTube Data API + Live Chat API
- **Twitch Integration**: Twitch Developer API + Chat API
- **配額管理**: 所有使用者共用 API 配額，高效利用

## 🚀 分階段開發規劃

### 第一階段 - 核心功能（立即可用）
✅ **基礎系統**
- Google 登入 + userId 隨機生成
- 基礎後台管理介面（響應式、雙語言、雙主題）
- 前台顯示頁面（聊天室、斗內進度軸、時間顯示、Loading）
- 綠界 Webhook 整合
- WebSocket 即時通訊
- 基礎安全防護

✅ **立即可用功能**
- 手動輸入聊天訊息測試顯示
- 手動調整斗內進度軸
- 樣式設定和預覽
- OBS 整合就緒

### 第二階段 - 平台整合（需要 API 設定）
⏳ **外部API整合**
- YouTube Live Chat API
- Twitch Chat API  
- 聊天室關鍵字分析
- 觀眾來訪記錄分析
- 完整直播監控介面

## 🔧 擴展性設計

### 預留接口
- **多直播平台**: 未來可能加入抖音、B站、Facebook Live 等平台
- **功能模組**: 預留接口給未來的功能擴展
- **第三方整合**: 除了綠界，未來可能整合其他金流服務

### 開關式功能
- 第二階段功能做成「開關式」設計
- 有 API 就啟用，沒有就關閉
- 後續取得 API 後只需填入設定，無需重新部署

## 📋 不需要的功能（此階段）

### 系統維運
- ❌ 自動備份：先不需要
- ❌ 監控告警：先不需要  
- ❌ 更新機制：先不需要零停機部署

### 管理功能
- ❌ 後台管理員/超級使用者角色：目前不需要

## 📦 交付內容

### 程式碼
1. **前端完整程式碼** (React + TypeScript，包含所有頁面和組件)
2. **後端完整程式碼** (Node.js + Express + TypeScript，包含所有 API 和業務邏輯)  
3. **資料庫架構設計和初始化腳本**
4. **配置檔案和環境設定**

### 部署指南
1. **混合雲完整部署步驟**
2. **環境變數設定說明**
3. **域名和 SSL 配置指南**
4. **資料庫設置和資料遷移步驟**
5. **Docker 容器化配置**

### 操作說明
1. **管理員操作手冊**（包含所有管理功能）
2. **一般使用者使用指南**
3. **常見問題排除方案**
4. **系統維護和更新流程**

### 技術文件
1. **完整 API 文件**
2. **資料庫架構設計文件**
3. **系統架構圖和技術說明**
4. **安全配置和最佳實務說明**
5. **API 申請教學**（YouTube & Twitch）

---

## ✅ 確認事項

所有需求已確認完成，系統將採用**完整程式碼 + 開關式功能**的開發方案，確保：
- ✅ 第一階段立即可部署使用
- ✅ 第二階段無縫升級，不需重新部署
- ✅ 完整功能預留，擴展容易
- ✅ 使用者友善，技術門檻低
